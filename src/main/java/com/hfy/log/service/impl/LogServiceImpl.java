package com.hfy.log.service.impl;import java.util.Date;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import com.hfy.base.mapper.BaseMapper;import com.hfy.base.service.impl.BaseServiceImpl;import com.hfy.cache.Cache;import com.hfy.log.mapper.LogMapper;import com.hfy.log.service.LogService;import com.hfy.utils.DateUtils;@Servicepublic class LogServiceImpl extends BaseServiceImpl implements LogService{	@Autowired	LogMapper logMapper;	@Override	public BaseMapper getMapper() {		// TODO Auto-generated method stub		return this.logMapper;	}	@Override	public int logSubmeter() {		// TODO Auto-generated method stub		int day = Integer.parseInt(Cache.getConfigValue("log.submeter.day"));		String tableName = "BASE_LOG"+DateUtils.format(new Date(),"yyyyMMddHHmmss");		StringBuffer sql = new StringBuffer();		sql.append(" create table "+tableName);		sql.append(" (");		sql.append(" ID              NVARCHAR2(50) not null,");		sql.append(" IP              VARCHAR2(50),");		sql.append(" OPER_PERSON     VARCHAR2(50),");		sql.append(" OPER_TYPE       VARCHAR2(50),");		sql.append(" OPER_TITLE      VARCHAR2(50),");		sql.append(" OPER_TABLE      VARCHAR2(50),");		sql.append(" OPER_URL        VARCHAR2(200),");		sql.append(" OPER_START_DATE TIMESTAMP(6),");		sql.append(" OPER_END_DATE   TIMESTAMP(6),");		sql.append(" OPER_TIME       VARCHAR2(50),");		sql.append(" OPER_DATA       VARCHAR2(4000),");		sql.append(" OPER_METHOD     VARCHAR2(200),");		sql.append(" OPER_EXCEPTION  VARCHAR2(4000),");		sql.append(" LOG_TYPE        VARCHAR2(50),");		sql.append(" constraint PK_"+tableName+" primary key (ID)");		sql.append(" )");		logMapper.logSubmeter1(sql.toString());		StringBuffer sql2 = new StringBuffer();		sql2.append(" INSERT INTO "+tableName+" SELECT * FROM base_log WHERE oper_end_date < sysdate"+day);		logMapper.logSubmeter2(sql2.toString());		StringBuffer sql3 = new StringBuffer();		sql3.append(" DELETE FROM base_log WHERE oper_end_date < sysdate"+day);		logMapper.logSubmeter3(sql3.toString());		return 1;	}	}